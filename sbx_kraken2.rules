rule kraken2:
    input:
        expand(str(QC_FP/'decontam'/'{{sample}}_{rp}.fastq.gz'),rp = Pairs)
    output:
        raw = str(CLASSIFY_FP/'kraken2'/'raw'/'{sample}-raw.tsv'),
        summary = str(CLASSIFY_FP/'kraken2'/'{sample}-taxa.tsv')
    params:
        db = Cfg["sbx_kraken2"]["db"],
        paired_end = "--paired" if Cfg['all']['paired_end'] else ""
    threads:
        Cfg["sbx_kraken2"]["threads"]
    conda:
        "sbx_kraken2_env.yml"
    shell:
        """
        kraken2 --gzip-compressed \
                --db {params.db} \
                --report {output.summary} \
                {params.paired_end} {input} \
                > {output.raw}
        """

rule all_kraken2:
    input:
        a = expand(str(CLASSIFY_FP/'kraken2'/'raw'/'{sample}-raw.tsv'), sample = Samples.keys()),
        b = expand(str(CLASSIFY_FP/'kraken2'/'{sample}-taxa.tsv'), sample = Samples.keys())
